module m1cs.Actuators

import "config/ActuatorBase.pkl"

///
/// Overrides are demonstrated here.  The most difficult one is trakIRParams which must be entered like
/// an array. Key in bracket is the segment name.
///
actuatorConfig: ActuatorBase.ActuatorConfig = (ActuatorBase.defaultActuatorConfig) {
  ["B1"] {
    act2 {
      positionLoopConfig {
        gainFactor = -100.2
        trkCtrl {
          Kp = 1.25
        }
        trkIRParams {
          [0] = 100.0
          [1] = 200.0
          [2] = 300.0
        }
      }
      positionLimits {
        lowerLimit = -10.1
      }
      targetGenConfig {
        amplitude = -20.2
      }
      offloadMotorConfig = new {
        mode = "CONT"
        contGain = 2.345
        limits = new {
          offset = 90.0
          scaleFactor = .75
        }
      }
      snubberMotorConfig = new {
        discStart = 2.02
      }
    }
  }
  ["B2"] {
    act1 {
      snubberMotorConfig = new {
        discStop = 5.0
      }
    }
  }
}

/// When called with pkl eval -m output/ Actuators.pkl, this will generate the Actuators.json file
output {
  files {
    ["Actuators.json"] {
      value = actuatorConfig
      renderer = new JsonRenderer {}
    }
  }
}